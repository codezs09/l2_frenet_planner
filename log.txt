06.01
- interface change from ctypes to cpp call

06.02~06.04
- change car and obstacle class and methods
- refactor CubicSpline2D method
- Refactor to_frenet and to_cartesian methods

06.05
- Add ToFrenet and ToCartesian methods for Obstacle class
- Update ego car pose and obstacle poses to next state in the loop

06.06
- refactor Car getPose methods
- finish main loop framework

06.07
- box to box collision detection
- if not collided, then calculate box to box distance calculation (at the end it's point to line problem)
- add rotate and pose_to_box utils
- add getBox method for Obstacle and Car class
- improve is_collision speed by avoiding unnecessary SAT check
- refactor is_collision and inverse_distance_to_obstacle method for FrenetPath class

06.08
- fix build and warning errors 
- add termination condition for main loop when the ego car reaches to end of destination
- add time cost calculation for main loop
- fix running bugs: 
    - json parsing error
    - parse waypoint bugs
    - fix search_index not containing last element for CubicSpline1D
    - fix find_s bug for CubicSpline2D

06.09
- FIX moving clitch with gdb debugging tool
- FIX no response to obstacles
- Using MessagePack to do data logging for following fields 
    - timestamp
    - ego car (pose, twist, accel)
    - best path (poses)
    - obstacles (pose)
    - candidate paths (poses)

06.10
- Add postprocessing script for logged data, with
    - data parsing
    - visualization
        - ego car box 
        - candiate trajectories in grey 
        - best trajectory in red
        - waypoints and its fitted cubic reference line (OPTIONAL)
        - obstacles and predicted movements
        - lane lines 

06.20
- Add lane lines instead of single waypoints
- Add lane change logic
- Add logic to decide which lane the obstacle is currently in

06.23
- Loop paths for each lane
- Debug
- Trajectory selection for each lane

06.25
- Log and Visualize each lane and path
    - Every lane boundary (cubis spline representation)
    - Every selected trajectories in each Lane

06.28
- Fix bug: ego car not in lane

06.29
- Refactor to local planning
    - Convert to local frame w.r.t. ego car

06.30
    - Add ego car state change estimation
    - Add initial planning point at local frame, planning_init_point_local

07.03
    - Pipeline for local planning able to run but trajectory selected around 3.5s not expected. 
    - Add unit test for coordinate conversion between global and local pose

07.04
    - Add plots for local planning. Nothing wrong from the local planning results
    - Add gtest and unit tests for coordinate conversion between Cartesian and Frenet frame

07.06
    - Print cost to debug why path selection jumps.

07.24
    - add flag to choose between local vs global planning: FLAGS_local_planning, global fine
    - TODO: Single frame debug mode? (Nahh..)

07.25
    - Add mode to: Need to output trajectories for each lane; plot all cadidate trajectories on each d; and costs
    - Problem identified. Wrong output of collision check results. Add unit test.
    - Found the bug: numeric_limits<double>::min() caution to use (representing the minimum POSITIVE double value)
    
07.26
    - Refactor the lane width: moving from hyperparameter to bind to json definition.
    - Test sensor drift: add noise to ego car pose and obstacle pose.

07.27 
    - Add plots for sensor effects
    - Fixed a bug of sensor noise generation (wrong data types ints)
    - Add unit tests for Gaussian noise generation: pass. 
    - Dubug why the test failed with drift? (UNKNOWN) -> FIXED somehow but not sure why. Line 508 main.cpp 
        - Reason explained in doc: 07/29/2023 Planning Drifting for Local Planning
        - Revert the change
    - Identified problem of state change estimation. Temp Fix made. 

07.30 
    - Refactor temp fix to neat and relate sensor error to add-on state change estimation error. 

08.02
    - Add Following mode.
        - Bug 1: as the vehicle near stop, the path starts to wave? 仔细放大看，path线硬折来折去，有问题。
          即使把sensor noise去掉了仍然有同样的问题。
        - Bug 2: 刹车太急，意味着 VelocityKeeping 和 Following 模式切换不平顺，可能obstacle cost weights太小。

08.03
    - Extend all frenet paths to the same lengths to calculate costs
    - 异常轨迹排查再筛掉一些。

08.13
    - TODO： 修复无sensor error时 轨迹停下来的时候也会偏； 可以只用一个 d 轨迹：  首要先解决的是能停住车。

    - TODO: Prepare results. 
        - Discuss how sensor drift and noise affects the estimation error of state change.
            - Time Plots of yaw rate and speed sensor measurements vs ground truth (indicating drift and std_dev). 
            - Time plots of state change estimation error (x, y, theta), or 
            - Plots (like Correlation Matrix) of state change estimation error (x, y, theta) vs sensor noise (speed, yaw_rate). Prefer this. 
        - Comparison of local planning results vs Global planning results. 
            - GIF of local planning results. 
            - GIF of global planning results. 
            - 连续两帧轨迹的对比。 
            - 所有轨迹（虚线）都画出来，这部分可以稀疏，更便于观察关系。所有帧规划起始点连线起来。

        - Discuss at which extent of the sensor noise the planning starts to fail. 
            - GIF when the planning starts to drift. 
            - 连续两帧轨迹的对比，看是否侧向偏移的距离已经超出了plan的速度。
            - Time plot of the lateral planned speed vs drifted speed.

        - Prepare the GIF of planning results under each category.
        - Rewrite the markdown README and acknowledge the original repo.
        - Time cost 不是本文核心，不画。也省去了优化工作。

    - TOFIX: 
        - Ego car's yaw, yaw_rate, and yaw_accel are not matched. 
            - Reason: It's because this is planned in local frame. The data in continuous frame are not associated to each other. 
            - 误差都设为0， 观察是否还有这个问题。或者在global frame下观察是否还有这个问题。
        - Initial yaw jump not reasonable. This can be smoothened. 


- TODO: Add following/stopping mode. (THIS IS A BIG CHANGE. BUT FOR SIMPLE RESULTS, I can do this mode only hard coded just to show the results.) 
    - Loop obstacles, if its lane_id is same as ego car, convert to Frenet frame. 
    - Find the closest obstacle same lane ahead. 
    - If the distance is less than a threshold, generate s(t). 
    - Combine with d(t) to generate candidate trajectories under this mode. 
    - Evaluate costs and select the best one under this mode. Do this for ego lane only. 
    - 评估下这儿的工作量，单lane stop场景仍然是评价最理想的场景。



- FrenetOptimalTrajectory 输出单条lane下选择的最优路径和相应 costs，可能为空

CHANGES: 
- may use pybind11 instead of ctypes. Tried but vector size change not supported.
- update methods w.r.t obstables: isCollision, etc. 
- change obstacle representation to four corners
- Add moving cars  ->  Needs fake Prediction module
- Change planning frequency to 10 Hz
- Add more lanes, add lane deciding logic
- Add following/stopping mode, Lane Change mode

- Add sensor models and state estimation module. 
- finish planning in local coordinates. 
- convert global coordinates to local.
- convert back to global. 


Question: 
- 每帧是要update initial conditions 包括 obstacle的位置的
- Obstacles define has a problem: Only defined bottom-left and 
  upper-right corners while assuming its edges parallel to axis. 
- is obstacle shape converted in Frenet as well? 